<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!--   Managing Content Security - START   -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self'; 
    style-src 'self' 'unsafe-inline'; 
    script-src 'self' 'unsafe-inline' https://therrpmarketing.github.io https://www.gstatic.com https://www.googleapis.com; 
    connect-src 'self' https://*.firebaseio.com https://*.googleapis.com wss://*.firebaseio.com;
    img-src 'self' data:;">

  <!--   Managing Content Security - END   -->

  <title>Advanced Settings</title>
  <link rel="stylesheet" href="../../cmp-assets/cmp-css/cmp-style.css" />
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar"></div>

  <!-- Main Content -->
  <div class="main-content">
    <h1>Advanced Settings</h1>
    <p>Configure advanced consent management settings for full customization and control.</p>

    <!-- Settings Cards Section -->

  <!-- General Cookie Settings Section START -->
    
    <div class="card-grid">
      <div class="cookie-categories cmp-card">
        <h2>General Cookie Settings</h2>
        <p>Define domain rules, SameSite behavior, and secure cookie preferences.</p>

        <div class="cookie-categories setting-group">
          <label for="cookie-domain">Cookie Domain:</label>
          <p>Specify the domain where cookies will be set.</p>
          <input type="text" id="cookie-domain" name="cookie-domain" placeholder="Enter Cookie Domain" />
         </div>

        <div class="setting-group">
          <label for="same-site-policy">SameSite Policy:</label>
          <p class="description">Choose the SameSite policy for cookies.</p>
          <select id="same-site-policy" name="same-site-policy">
            <option value="Strict">Strict</option>
            <option value="Lax">Lax</option>
            <option value="None">None</option>
          </select>
        </div>

      <div class="cookie-categories cmp-card">
        <h2>Cross-Origin Cookie Behavior</h2>
        <p>Control how cookies behave in cross-origin scenarios with enhanced security options.</p>

        <div class="setting-group">
          <label class="checkbox-label"> Secure Cookie
            <input type="checkbox" id="secure-cookie-toggle" name="secure-cookie-toggle" />
          </label>
          <p class="description">Restricts cookie transmission to HTTPS connections only.</p>
        </div>

        <div class="setting-group">
          <label class="checkbox-label"> HttpOnly Cookie
          <input type="checkbox" id="http-only-toggle" name="http-only-toggle" />
          </label>
          <p class="description">Prevents access to the cookie via JavaScript for added security.</p>
        </div>
         <button class="add-category-btn save-btn" id="save-cookie-settings">Save Settings</button>
        </div>


        
      </div>


  <!-- General Cookie Settings Section END -->
      

  <!-- Cookie Expiry Settings Section inside START-->
      <div class="cookie-categories cmp-card">
      <h2>Cookie Expiry Settings</h2>
      <p>Manage cookie expiration durations per category.</p>
    
      <div class="cookie-expiry-wrapper">
        <div class="cookie-categories cookie-expiry-group">
          <label for="expiry-necessary">Necessary Cookie Expiry (days):</label>
          <input type="number" id="expiry-necessary" min="1" max="395" value="365">
        </div>
    
        <div class="cookie-expiry-group">
          <label for="expiry-functional">Functional Cookie Expiry (days):</label>
          <input type="number" id="expiry-functional" min="1" max="395" value="180">
        </div>
    
        <div class="cookie-expiry-group">
          <label for="expiry-analytics">Analytics Cookie Expiry (days):</label>
          <input type="number" id="expiry-analytics" min="1" max="395" value="180">
        </div>
    
        <div class="cookie-expiry-group">
          <label for="expiry-performance">Performance Cookie Expiry (days):</label>
          <input type="number" id="expiry-performance" min="1" max="395" value="365">
        </div>
    
        <div class="cookie-expiry-group">
          <label for="expiry-advertisement">Advertisement Cookie Expiry (days):</label>
          <input type="number" id="expiry-advertisement" min="1" max="395" value="365">
        </div>
    
        <button class="add-category-btn save-btn" id="save-expiry-settings">Save Expiry Settings</button>
      </div>
    </div>

<!-- Cookie Expiry Settings Section inside END-->

      
<!--       <div class="cookie-categories cmp-card">
        <h2>Consent Logging Settings</h2>
        <p>Enable or disable consent logs and define retention policy.</p>
        <button class="add-category-btn">Manage Logs</button>
      </div> -->

<!--       <div class="cookie-categories cmp-card">
        <h2>Consent Mode & Preferences</h2>
        <p>Control integration with Google Consent Mode v2 and user preference mapping.</p>
        <button class="add-category-btn">Setup Consent Mode</button>
      </div>
 -->

<!--   Notification Card Detail START     -->
            <!--       <div class="cookie-categories cmp-card">
              <h2>Notification Settings</h2>
              <p>Enable admin alerts for user actions, errors, or major events.</p>
              <button class="add-category-btn">Configure Alerts</button>
            </div> -->

          <div class="cookie-categories cmp-card">
          <div class="notification-header">
            <h2>Notification Settings</h2>
            <span id="notification-bubble" class="notification-bubble hidden">●</span>
          </div>
          <p>Enable admin alerts for user actions, errors, or major events.</p>
        
          <!-- Notification Checkboxes -->
          <label>
            <input type="checkbox" id="errorNotifications" />
            Error Notifications
          </label>
          <br />
          <label>
            <input type="checkbox" id="actionNotifications" />
            Action Notifications
          </label>
          <br />
          <button class="cookie-categories save-notification-settings">Save Settings</button>
        
          <!-- Optional test bubble area -->
          <div id="notificationBubble" class="notification-message hidden">
            <span>New notification!</span>
          </div>
        </div>

      
<!--   Notification Card Detail END     -->


      
<!--       <div class="cookie-categories cmp-card">
        <h2>Custom Styling & Branding</h2>
        <p>Apply your brand theme: logo, colors, button styles.</p>
        <button class="add-category-btn">Customize Branding</button>
      </div> -->

<!--       <div class="cookie-categories cmp-card">
        <h2>User Preference Handling</h2>
        <p>Control how user preferences are stored and retrieved across sessions/devices.</p>
        <button class="add-category-btn">Edit Handling</button>
      </div> -->

<!--       <div class="cookie-categories cmp-card">
        <h2>Advanced Security Settings</h2>
        <p>Restrict access, enable IP filtering, and encryption settings.</p>
        <button class="add-category-btn">Security Options</button>
      </div> -->

<!--       <div class="cookie-categories cmp-card">
        <h2>Debugging & Developer Tools</h2>
        <p>Enable logging, testing tools, and dev mode toggles.</p>
        <button class="add-category-btn">Enable Tools</button>
      </div> -->
      
    </div>
  </div>

  <!-- Sidebar Script -->
  <script>
    fetch('../../shared/sidebar.html')
      .then(response => {
        if (!response.ok) throw new Error('Sidebar file not found.');
        return response.text();
      })
      .then(data => {
        document.getElementById('sidebar').innerHTML = data;
      })
      .catch(err => {
        console.error('Error loading sidebar:', err);
        alert('Error loading sidebar. Please check the file path or server configuration.');
      });
  </script>

<!-- Firebase Setup for General Cookie Setting START -->

        <script type="module">
          // Firebase SDK imports
          import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
          import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
        
          // Firebase config
          const firebaseConfig = {
            apiKey: "AIzaSyB0yG8sGI47Zdncr21avyeJauW4Z6qJU8E",
            authDomain: "cookie-cmp-sys.firebaseapp.com",
            databaseURL: "https://cookie-cmp-sys-default-rtdb.firebaseio.com",
            projectId: "cookie-cmp-sys",
            storageBucket: "cookie-cmp-sys.appspot.com",
            messagingSenderId: "252822009652",
            appId: "1:252822009652:web:6bfbdf28d98953ccb89761",
            measurementId: "G-DLGR6XFPP5"
          };
        
          // Initialize Firebase
          const app = initializeApp(firebaseConfig);
          const db = getDatabase(app);
        
          // Function to save general cookie settings
          function saveGeneralCookieSettings() {
            const cookieDomain = document.getElementById("cookie-domain").value;
            const sameSitePolicy = document.getElementById("same-site-policy").value;
            const secureCookie = document.getElementById("secure-cookie-toggle").checked;
            const httpOnlyCookie = document.getElementById("http-only-toggle").checked;
        
            const settingsData = {
              cookieDomain,
              sameSitePolicy,
              secureCookie,
              httpOnlyCookie
            };
        
            set(ref(db, "cookieSettings/general"), settingsData)
              .then(() => {
                alert("✅ Cookie settings saved successfully.");
              })
              .catch((error) => {
                console.error("❌ Error saving cookie settings:", error);
                alert("Failed to save settings.");
              });
          }
        
          // Attach event listener after DOM is loaded
          document.getElementById("save-cookie-settings").addEventListener("click", saveGeneralCookieSettings);
        </script>

<!-- Firebase Setup for General Cookie Setting END -->


  <!-- Firebase Setup for Cookie Expiry with Categories Setting START -->
         <script type="module">
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
      
        const firebaseConfig = {
          apiKey: "AIzaSyB0yG8sGI47Zdncr21avyeJauW4Z6qJU8E",
          authDomain: "cookie-cmp-sys.firebaseapp.com",
          databaseURL: "https://cookie-cmp-sys-default-rtdb.firebaseio.com",
          projectId: "cookie-cmp-sys",
          storageBucket: "cookie-cmp-sys.firebasestorage.app",
          messagingSenderId: "252822009652",
          appId: "1:252822009652:web:6bfbdf28d98953ccb89761"
        };
      
        const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
        const db = getDatabase(app);
      
        // Save general settings
        document.getElementById("save-cookie-settings").addEventListener("click", () => {
          const cookieDomain = document.getElementById("cookie-domain").value;
          const sameSitePolicy = document.getElementById("same-site-policy").value;
          const secureCookie = document.getElementById("secure-cookie-toggle").checked;
          const httpOnlyCookie = document.getElementById("http-only-toggle").checked;
      
          const settingsData = {
            cookieDomain,
            sameSitePolicy,
            secureCookie,
            httpOnlyCookie
          };
      
          set(ref(db, "cookieSettings/general"), settingsData)
            .then(() => alert("Cookie settings saved successfully."))
            .catch((error) => {
              console.error("Error saving cookie settings:", error);
              alert("Failed to save settings.");
            });
        });
      
        // Save expiry settings
        document.getElementById("save-expiry-settings").addEventListener("click", () => {
          const expirySettings = {
            necessary: parseInt(document.getElementById("expiry-necessary").value),
            functional: parseInt(document.getElementById("expiry-functional").value),
            analytics: parseInt(document.getElementById("expiry-analytics").value),
            performance: parseInt(document.getElementById("expiry-performance").value),
            advertisement: parseInt(document.getElementById("expiry-advertisement").value)
          };
      
          set(ref(db, "cookieSettings/expiry"), expirySettings)
            .then(() => alert("Cookie expiry settings saved successfully."))
            .catch((error) => {
              console.error("Error saving expiry settings:", error);
              alert("Failed to save expiry settings.");
            });
        });
      </script>
<!-- Firebase Setup for Cookie Expiry with Categories Setting END -->


<!-- Firebase Setup for NOTIFICATION SETTING START -->
        <script>
        // Initialize Firebase (Already done in your project, so no need to repeat this part)
        const database = getDatabase(); // This is for Realtime Database
        
        // Reference to the notification settings in the Realtime Database
        const settingsRef = ref(database, 'settings/notificationSettings');
        
        // Fetch settings from Firebase Realtime Database
        function loadNotificationSettings() {
          get(settingsRef).then((snapshot) => {
            if (snapshot.exists()) {
              const settings = snapshot.val();
              // Update checkboxes based on Firebase data
              document.getElementById('errorNotifications').checked = settings.errorNotifications;
              document.getElementById('actionNotifications').checked = settings.actionNotifications;
            } else {
              console.log("No settings found in the database.");
            }
          }).catch((error) => {
            console.error('Error fetching settings:', error);
          });
        }
        
        // Save settings to Firebase Realtime Database
        function saveNotificationSettings() {
          const errorNotifications = document.getElementById('errorNotifications').checked;
          const actionNotifications = document.getElementById('actionNotifications').checked;
        
          // Save the new settings to Firebase
          set(settingsRef, {
            errorNotifications: errorNotifications,
            actionNotifications: actionNotifications
          }).then(() => {
            alert('Notification settings saved!');
          }).catch((error) => {
            console.error('Error saving settings:', error);
          });
        }
        
        // Event listener for saving settings when the button is clicked
        document.querySelector('.save-notification-settings').addEventListener('click', saveNotificationSettings);
        
        // Load the settings when the page loads
        window.onload = function() {
          loadNotificationSettings();
        };
        </script>
<!-- Firebase Setup for NOTIFICATION SETTING END -->

<!-- Notification Card Details - START -->
<!-- Advance Setting Handle the Notification card "Configure Alerts" button START -->
        <script>
        document.querySelector('.add-category-btn').addEventListener('click', function() {
            // For demonstration, toggle an alert settings form (you can create an actual form)
            const alertSettingsForm = document.createElement('div');
            alertSettingsForm.innerHTML = `
                <h3>Set Notification Preferences</h3>
                <label>
                    <input type="checkbox" id="errorAlerts" /> Enable Alerts for Errors
                </label><br>
                <label>
                    <input type="checkbox" id="userActionAlerts" /> Enable Alerts for User Actions
                </label><br>
                <button id="saveAlertSettings">Save Settings</button>
            `;
            document.querySelector('.cookie-categories').appendChild(alertSettingsForm);
            
            // Event listener for the "Save Settings" button
            document.querySelector('#saveAlertSettings').addEventListener('click', function() {
                // Get user preferences from checkboxes
                const errorAlertsEnabled = document.querySelector('#errorAlerts').checked;
                const userActionAlertsEnabled = document.querySelector('#userActionAlerts').checked;
                
                // Save to Firebase Realtime Database
                saveNotificationSettings(errorAlertsEnabled, userActionAlertsEnabled);
            });
        });
        
        // Function to save settings to Firebase
        function saveNotificationSettings(errorAlertsEnabled, userActionAlertsEnabled) {
            const userId = 'user123'; // This should be dynamic based on the current user (could be a logged-in user's ID)
            
            // Set the notification settings in Firebase
            const settingsRef = ref(getDatabase(), 'notificationSettings/' + userId);
            set(settingsRef, {
                errorAlertsEnabled: errorAlertsEnabled,
                userActionAlertsEnabled: userActionAlertsEnabled
            })
            .then(() => {
                alert("Settings saved successfully!");
            })
            .catch((error) => {
                console.error("Error saving settings: ", error);
                alert("Failed to save settings.");
            });
        }
        </script>
<!-- Advance Setting Handle the Notification card "Configure Alerts" button END -->

    <!--   Notification Setting Script-START -->
            <script> 
            const userId = "admin_default"; // You can replace this with dynamic admin UID if needed
            
            import { get, child } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
            
            const dbRef = ref(database);
            get(child(dbRef, `notificationSettings/${userId}`))
              .then((snapshot) => {
                if (snapshot.exists()) {
                  const savedSetting = snapshot.val();
                  notificationSetting = savedSetting;
                  updateNotificationUI(); // Reflect the current state in UI
                } else {
                  console.log("No previous setting found.");
                }
              })
              .catch((error) => {
                console.error("Error fetching notification setting:", error);
              });
            </script>
    <!--   Notification Setting Script-END -->

<!--   Notification Setting - Save Preferences to Firebase START -->
            <script>
            import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
          
            // Replace with your actual admin/user ID logic
            const adminId = "admin-demo"; 
          
            document.querySelector(".save-notification-settings").addEventListener("click", () => {
              const errorChecked = document.getElementById("errorNotifications").checked;
              const actionChecked = document.getElementById("actionNotifications").checked;
          
              const db = getDatabase();
              set(ref(db, 'cmp-notification-preferences/' + adminId), {
                errorNotifications: errorChecked,
                actionNotifications: actionChecked,
                timestamp: Date.now()
              }).then(() => {
                // Show the notification bubble briefly
                document.getElementById("notificationBubble").classList.remove("hidden");
                setTimeout(() => {
                  document.getElementById("notificationBubble").classList.add("hidden");
                }, 3000);
              });
            });
          </script>
  <!--   Notification Setting - Save Preferences to Firebase END -->

  
<!--   Notification Setting - Load Settings on Page Load from Firebase START -->
          <script>
          import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
        
          // Same admin ID as before
          const adminId = "admin-demo";
        
          window.addEventListener("DOMContentLoaded", () => {
            const db = getDatabase();
            const settingsRef = ref(db, 'cmp-notification-preferences/' + adminId);
        
            get(settingsRef).then((snapshot) => {
              if (snapshot.exists()) {
                const data = snapshot.val();
                document.getElementById("errorNotifications").checked = data.errorNotifications || false;
                document.getElementById("actionNotifications").checked = data.actionNotifications || false;
              }
            }).catch((error) => {
              console.error("Failed to load preferences:", error);
            });
          });
        </script>
  <!--   Notification Setting - Load Settings on Page Load from Firebase START -->

  <!--   Notification Setting - Triggering Real Notifications Based on Preferences from Firebase START -->
        <script>
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
      
        const adminId = "admin-demo";
        const db = getDatabase();
      
        // Utility function to show the bubble
        function showNotificationBubble(message = "New notification!") {
          const bubble = document.getElementById("notificationBubble");
          bubble.querySelector("span").textContent = message;
          bubble.classList.add("visible");
      
          // Auto-hide after 5 seconds
          setTimeout(() => {
            bubble.classList.remove("visible");
          }, 5000);
        }
      
        // Simulate a system event (you’ll later trigger these from real events)
        function simulateEvent(type) {
          const settingsRef = ref(db, 'cmp-notification-preferences/' + adminId);
      
          get(settingsRef).then((snapshot) => {
            if (snapshot.exists()) {
              const prefs = snapshot.val();
      
              if (type === "error" && prefs.errorNotifications) {
                showNotificationBubble("⚠️ Error occurred in system");
              } else if (type === "action" && prefs.actionNotifications) {
                showNotificationBubble("✅ New user action recorded");
              }
            }
          });
        }
      
        // DEMO ONLY: Simulate notifications on page load (remove this part in real use)
        setTimeout(() => simulateEvent("error"), 2000);
        setTimeout(() => simulateEvent("action"), 6000);
      </script>
  <!--   Notification Setting - Triggering Real Notifications Based on Preferences from Firebase END -->



  
<!-- Notification Card Details - START -->
  
</body>
</html>
