<script>
  // Firebase setup
  const firebaseConfig = {
    apiKey: "AIzaSyB0yG8sGI47Zdncr21avyeJauW4Z6qJU8E",
    authDomain: "cookie-cmp-sys.firebaseapp.com",
    databaseURL: "https://cookie-cmp-sys-default-rtdb.firebaseio.com",
    projectId: "cookie-cmp-sys",
    storageBucket: "cookie-cmp-sys.firebasestorage.app",
    messagingSenderId: "252822009652",
    appId: "1:252822009652:web:6bfbdf28d98953ccb89761",
    measurementId: "G-DLGR6XFPP5"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const database = firebase.database(app);

  // Function to listen and display consent logs in real-time
  function fetchConsentLogs() {
    const consentLogList = document.getElementById("consent-log-list").getElementsByTagName('tbody')[0];

    // Listen for value changes on the consentLogs node
    database.ref('consentLogs').orderByChild('timestamp').on('value', (snapshot) => {
      const logs = snapshot.val();
      consentLogList.innerHTML = ''; // Clear table

      if (logs) {
        Object.keys(logs).forEach(key => {
          const log = logs[key];

          const logRow = document.createElement('tr');

          const sessionIdCell = document.createElement('td');
          sessionIdCell.textContent = log.session_id;

          const actionCell = document.createElement('td');
          actionCell.textContent = log.action;

          const timestampCell = document.createElement('td');
          const formattedTimestamp = new Date(log.timestamp).toLocaleString();
          timestampCell.textContent = formattedTimestamp;

          logRow.appendChild(sessionIdCell);
          logRow.appendChild(actionCell);
          logRow.appendChild(timestampCell);

          consentLogList.appendChild(logRow);
        });
      } else {
        // No logs found
        const emptyRow = document.createElement('tr');
        const emptyCell = document.createElement('td');
        emptyCell.colSpan = 3;
        emptyCell.textContent = 'No consent logs found.';
        emptyCell.classList.add('empty-row');
        emptyRow.appendChild(emptyCell);
        consentLogList.appendChild(emptyRow);
      }
    });
  }

  // Call real-time fetch on DOMContentLoaded
  document.addEventListener("DOMContentLoaded", fetchConsentLogs);
</script>
