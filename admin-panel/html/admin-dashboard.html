<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
</head>
<body>
  <div class="dashboard-wrapper">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo-placeholder">
        <div class="logo-box">Your Logo</div>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li class="active">Dashboard</li>
          <li>Cookie Categories</li>
          <li>Customize Banner</li>
          <li>Consent Logs</li>
          <li>Consent Analytics</li>
          <li>User Preferences</li>
          <li>Advanced Settings</li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="main-header">
        <h1>Admin Dashboard</h1>
      </header>

      <!-- Stat Cards -->
      <section class="stat-cards">
        <div class="card" id="accept-count">
          <h2>✅ Accepted</h2>
          <p>0</p>
        </div>
        <div class="card" id="reject-count">
          <h2>❌ Rejected</h2>
          <p>0</p>
        </div>
        <div class="card" id="customize-count">
          <h2>⚙️ Customized</h2>
          <p>0</p>
        </div>
      </section>

      <!-- Graph Area -->
      <section class="graph-section">
        <h2>Consent Trends</h2>
        <canvas id="consentChart" width="600" height="300" style="background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 12px;"></canvas>
      </section>
    </main>
  </div>

  <script>
    // Firebase Config (replace with yours if needed)
    const firebaseConfig = {
      apiKey: "AIzaSyB0yG8sGI47Zdncr21avyeJauW4Z6qJU8E",
      authDomain: "cookie-cmp-sys.firebaseapp.com",
      databaseURL: "https://cookie-cmp-sys-default-rtdb.firebaseio.com",
      projectId: "cookie-cmp-sys",
      storageBucket: "cookie-cmp-sys.firebasestorage.app",
      messagingSenderId: "252822009652",
      appId: "1:252822009652:web:6bfbdf28d98953ccb89761"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function updateCountsAndChart() {
      const ref = db.ref("cookie-consent");
      ref.once("value", function(snapshot) {
        var accept = 0, reject = 0, customize = 0;
        var timestamps = {};

        snapshot.forEach(function(child) {
          var val = child.val();
          var action = val.action;
          var ts = new Date(val.timestamp || child.key * 1);
          var label = ts.getFullYear() + "-" + (ts.getMonth()+1) + "-" + ts.getDate();

          if (!timestamps[label]) {
            timestamps[label] = { accept: 0, reject: 0, customize: 0 };
          }

          if (action === "accept") {
            accept++;
            timestamps[label].accept++;
          } else if (action === "reject") {
            reject++;
            timestamps[label].reject++;
          } else if (action === "customize") {
            customize++;
            timestamps[label].customize++;
          }
        });

        // Update Stat Cards
        document.getElementById("accept-count").querySelector("p").textContent = accept;
        document.getElementById("reject-count").querySelector("p").textContent = reject;
        document.getElementById("customize-count").querySelector("p").textContent = customize;

        // Prepare Chart Data
        var labels = [];
        var acceptData = [], rejectData = [], customizeData = [];

        for (var day in timestamps) {
          labels.push(day);
          acceptData.push(timestamps[day].accept);
          rejectData.push(timestamps[day].reject);
          customizeData.push(timestamps[day].customize);
        }

        drawChart(labels, acceptData, rejectData, customizeData);
      });
    }

    function drawChart(labels, acceptData, rejectData, customizeData) {
      var canvas = document.getElementById("consentChart");
      var ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      var width = canvas.width;
      var height = canvas.height;
      var padding = 40;
      var barWidth = 20;
      var max = Math.max.apply(null, acceptData.concat(rejectData, customizeData)) || 1;
      var gap = 10;

      for (var i = 0; i < labels.length; i++) {
        var x = padding + i * (barWidth * 3 + gap);
        var yAccept = height - padding - (acceptData[i] / max) * (height - 2 * padding);
        var yReject = height - padding - (rejectData[i] / max) * (height - 2 * padding);
        var yCustomize = height - padding - (customizeData[i] / max) * (height - 2 * padding);

        // Accept Bar
        ctx.fillStyle = "#28a745";
        ctx.fillRect(x, yAccept, barWidth, height - padding - yAccept);

        // Reject Bar
        ctx.fillStyle = "#dc3545";
        ctx.fillRect(x + barWidth, yReject, barWidth, height - padding - yReject);

        // Customize Bar
        ctx.fillStyle = "#ffc107";
        ctx.fillRect(x + barWidth * 2, yCustomize, barWidth, height - padding - yCustomize);

        // Label
        ctx.fillStyle = "#333";
        ctx.font = "10px sans-serif";
        ctx.fillText(labels[i], x, height - padding + 12);
      }
    }

    // Live refresh
    setInterval(updateCountsAndChart, 5000);
    updateCountsAndChart();
  </script>
</body>
</html>
